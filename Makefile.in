LIBNAME = ./bin/@lib_name@
EXEC_NAME = ./bin/@package_name@/@exec_name@
OBJECTS = $(patsubst %.c,%.o,$(wildcard *.c src/dns/*.c))
CFLAGS = -gdwarf-2 -O3 -Wall
LDFLAGS = -L/usr/local/lib -shared -rdynamic -Wl,-soname,$(LIBNAME) -Wl,--no-undefined 
LDLIBS = -lnfnetlink -lnetfilter_queue -lpthread -lpcap -lpython2.7

build : $(OBJECTS)
	mkdir -p bin/dnssift
	cp -r src/classifier/* bin/dnssift
	cp setup.py bin
	$(MAKE) -C src/classifier
	$(CC) $(OBJECTS) src/classifier/classifier_interface.o -o $(EXEC_NAME) $(LDLIBS) $(CFLAGS)	

install : build
	cd bin && python setup.py install
	
test :
	python -m @package_name@.classifier
	
clean :
	rm -rf $(EXEC_NAME) $(LIB_NAME) *.o *~ src/dns/*.o src/dns/*~ bin setup.py
	$(MAKE) -C src/classifier clean
.PHONY: clean

